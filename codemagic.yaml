workflows:
  android-kiosk-launcher:
    name: Build Kiosk Launcher APK
    max_build_duration: 30

    machine:
      os: linux  # Use Linux virtual machine for Android

    environment:
      vars:
        # Set this to true to build a release version
        BUILD_RELEASE: false

        # Optional: Signing credentials for release
        # Add these in Codemagic > Environment Variables as secure values
        # CM_KEYSTORE: base64-encoded .jks file
        # CM_KEYSTORE_PASSWORD: your_keystore_password
        # CM_KEY_PASSWORD: your_key_password
        # CM_KEY_ALIAS: your_key_alias

    scripts:
      - name: Decode keystore (only if release)
        script: |
          if [ "$BUILD_RELEASE" = "true" ]; then
            echo $CM_KEYSTORE | base64 -d > /tmp/keystore.jks
          fi

      - name: Set Gradle wrapper permissions
        script: chmod +x ./gradlew

      - name: Build APK
        script: |
          if [ "$BUILD_RELEASE" = "true" ]; then
            ./gradlew assembleRelease
          else
            ./gradlew assembleDebug
          fi

    artifacts:
      - app/build/outputs/**/*.apk

    publishing:
      email:
        recipients:
          - your-email@example.com  # Optional: change or delete
